<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="HardwareMonitorWinUI3.Views.MainWindow"
        x:Name="RootWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="using:HardwareMonitorWinUI3.UI"
        xmlns:models="using:HardwareMonitorWinUI3.Models"
        Title="Hardware Monitor WinUI 3">

    <Grid>
        <Grid.Resources>
            <ui:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <ui:BoolToExpandIconConverter x:Key="BoolToExpandIconConverter"/>
            <ui:BoolToAccentBrushConverter x:Key="BoolToAccentBrushConverter"/>
            <ui:ViewModeToVisibilityConverter x:Key="ViewModeToVisibilityConverter"/>
            <ui:TemperatureUnitToBoolConverter x:Key="TemperatureUnitToBoolConverter"/>

            <DataTemplate x:Key="TreeHardwareNodeTemplate" x:DataType="models:HardwareNode">
                <Expander IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}"
                          HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch"
                          CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                          BorderThickness="1"
                          Margin="0,0,0,8"
                          Tag="{x:Bind Name, Mode=OneWay}"
                          RightTapped="HardwareCard_RightTapped">
                    <FlyoutBase.AttachedFlyout>
                        <MenuFlyout>
                            <MenuFlyoutItem Text="Hide this item" Click="HideHardware_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE711;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </FlyoutBase.AttachedFlyout>
                    <Expander.Header>
                        <Grid Margin="0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <FontIcon Grid.Column="0" Glyph="{x:Bind CategoryIcon, Mode=OneWay}" FontSize="16" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind Name, Mode=OneWay}" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="2" Text="{x:Bind SensorCount, Mode=OneWay}" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="12,0,0,0" VerticalAlignment="Center"/>
                        </Grid>
                    </Expander.Header>
                    <Expander.Content>
                        <ItemsControl ItemsSource="{x:Bind SensorGroups, Mode=OneWay}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="models:SensorGroup">
                                    <Expander IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}"
                                              HorizontalAlignment="Stretch"
                                              HorizontalContentAlignment="Stretch"
                                              CornerRadius="6"
                                              Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                              Margin="0,0,0,6">
                                        <Expander.Header>
                                            <Grid Margin="0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <FontIcon Grid.Column="0" Glyph="{x:Bind CategoryIcon, Mode=OneWay}" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="1" Text="{x:Bind CategoryName, Mode=OneWay}" FontWeight="Medium" FontSize="13" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Expander.Header>
                                        <Expander.Content>
                                            <Grid Margin="8,4,8,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Column="0" Text="Name" FontSize="11" FontWeight="SemiBold" Foreground="{ThemeResource TextFillColorTertiaryBrush}" Margin="0,0,0,8"/>
                                                <TextBlock Grid.Column="1" Text="Value" FontSize="11" FontWeight="SemiBold" Foreground="{ThemeResource TextFillColorTertiaryBrush}" MinWidth="100" TextAlignment="Right" Margin="0,0,0,8"/>
                                                <TextBlock Grid.Column="2" Text="Min" FontSize="11" FontWeight="SemiBold" Foreground="{ThemeResource TextFillColorTertiaryBrush}" MinWidth="120" TextAlignment="Right" Margin="0,0,0,8"/>
                                                <TextBlock Grid.Column="3" Text="Max" FontSize="11" FontWeight="SemiBold" Foreground="{ThemeResource TextFillColorTertiaryBrush}" MinWidth="120" TextAlignment="Right" Margin="0,0,0,8"/>
                                                <ItemsControl Grid.Row="1" Grid.ColumnSpan="4" ItemsSource="{x:Bind Sensors, Mode=OneWay}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate x:DataType="models:SensorData">
                                                            <Grid Margin="0,2,0,0">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                <TextBlock Grid.Column="0" Text="{x:Bind Name, Mode=OneWay}" FontSize="12" TextTrimming="CharacterEllipsis" ToolTipService.ToolTip="{x:Bind Name, Mode=OneWay}" VerticalAlignment="Center"/>
                                                                <TextBlock Grid.Column="1" Text="{x:Bind Value, Mode=OneWay}" FontSize="12" FontWeight="SemiBold" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" MinWidth="100" TextAlignment="Right" TextTrimming="CharacterEllipsis" ToolTipService.ToolTip="{x:Bind Value, Mode=OneWay}" VerticalAlignment="Center"/>
                                                                <TextBlock Grid.Column="2" Text="{x:Bind MinValue, Mode=OneWay}" FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}" MinWidth="120" TextAlignment="Right" TextTrimming="CharacterEllipsis" ToolTipService.ToolTip="{x:Bind MinValue, Mode=OneWay}" VerticalAlignment="Center"/>
                                                                <TextBlock Grid.Column="3" Text="{x:Bind MaxValue, Mode=OneWay}" FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}" MinWidth="120" TextAlignment="Right" TextTrimming="CharacterEllipsis" ToolTipService.ToolTip="{x:Bind MaxValue, Mode=OneWay}" VerticalAlignment="Center"/>
                                                            </Grid>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>
                                        </Expander.Content>
                                    </Expander>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Expander.Content>
                </Expander>
            </DataTemplate>

            <DataTemplate x:Key="SensorDataTemplate" x:DataType="models:SensorData">
                <Border Style="{StaticResource SensorCardStyle}">
                    <StackPanel Spacing="4">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon Glyph="{x:Bind Icon, Mode=OneWay}"
                                      FontFamily="Segoe MDL2 Assets"
                                      FontSize="12"
                                      VerticalAlignment="Center"/>
                            <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                                      FontSize="12"
                                      FontWeight="SemiBold"
                                      Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                      TextTrimming="CharacterEllipsis"
                                      TextWrapping="NoWrap"
                                      MaxLines="1"
                                      VerticalAlignment="Center"
                                      ToolTipService.ToolTip="{x:Bind Name, Mode=OneWay}"/>
                        </StackPanel>

                        <TextBlock Text="{x:Bind Value, Mode=OneWay}"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                   TextTrimming="CharacterEllipsis"
                                   TextWrapping="NoWrap"
                                   ToolTipService.ToolTip="{x:Bind Value, Mode=OneWay}"/>

                        <StackPanel Spacing="2" Margin="0,4,0,0">
                            <TextBlock Text="{x:Bind MinValue, Mode=OneWay}"
                                      FontSize="11"
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                      TextTrimming="CharacterEllipsis"
                                      TextWrapping="NoWrap"
                                      ToolTipService.ToolTip="{x:Bind MinValue, Mode=OneWay}"/>
                            <TextBlock Text="{x:Bind MaxValue, Mode=OneWay}"
                                      FontSize="11"
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                      TextTrimming="CharacterEllipsis"
                                      TextWrapping="NoWrap"
                                      ToolTipService.ToolTip="{x:Bind MaxValue, Mode=OneWay}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </DataTemplate>

            <DataTemplate x:Key="SensorGroupTemplate" x:DataType="models:SensorGroup">
                <Border Style="{StaticResource SensorGroupStyle}">
                    <StackPanel>
                        <Button Background="Transparent"
                               BorderThickness="0"
                               Padding="0"
                               HorizontalAlignment="Stretch"
                               HorizontalContentAlignment="Stretch"
                               Click="ToggleGroup_Click"
                               Tag="{Binding Mode=OneWay}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <FontIcon Grid.Column="0"
                                          FontFamily="Segoe MDL2 Assets"
                                          Glyph="{Binding IsExpanded, Converter={StaticResource BoolToExpandIconConverter}, Mode=OneWay}"
                                          FontSize="14"
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          Margin="0,0,8,0"
                                          VerticalAlignment="Center"/>

                                <FontIcon Grid.Column="1"
                                          Glyph="{Binding CategoryIcon, Mode=OneWay}"
                                          FontFamily="Segoe MDL2 Assets"
                                          FontSize="16"
                                          Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                          Margin="0,0,12,0"
                                          VerticalAlignment="Center"/>

                                <TextBlock Grid.Column="2"
                                          Text="{Binding CategoryName, Mode=OneWay}"
                                          FontSize="14"
                                          FontWeight="SemiBold"
                                          VerticalAlignment="Center"/>

                                <TextBlock Grid.Column="3"
                                           Text="{Binding SensorCount, Mode=OneWay}"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                           VerticalAlignment="Center"
                                           Margin="8,0,0,0"/>
                            </Grid>
                        </Button>

                        <ItemsControl ItemsSource="{Binding Sensors, Mode=OneWay}"
                                     Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <ItemsWrapGrid Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <StaticResource ResourceKey="SensorDataTemplate"/>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </DataTemplate>
        </Grid.Resources>

        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="48"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Background="Transparent">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="1"
                       Text="{x:Bind Title, Mode=OneWay}"
                       FontSize="12"
                       FontWeight="SemiBold"
                       Margin="16,0,0,0"
                       VerticalAlignment="Center"
                       Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
        </Grid>

        <Border Grid.Row="1">
            <Grid Margin="24,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE950;" FontSize="20" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" Margin="0,0,12,0"/>
                    <TextBlock Text="Hardware Monitor" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <Button Style="{StaticResource SpeedButtonStyle}" CornerRadius="8" MinWidth="40" Padding="8,0" ToolTipService.ToolTip="Hardware Display">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon Glyph="&#xE950;" FontSize="16"/>
                        </StackPanel>
                        <Button.Flyout>
                            <Flyout Placement="BottomEdgeAlignedRight">
                                <StackPanel Spacing="12" MinWidth="180">
                                    <TextBlock Text="Hardware Display" FontSize="14" FontWeight="SemiBold"/>
                                    <ToggleSwitch Header="Motherboard" IsOn="{x:Bind ViewModel.ShowMotherboard, Mode=TwoWay}"/>
                                    <ToggleSwitch Header="CPU" IsOn="{x:Bind ViewModel.ShowCPU, Mode=TwoWay}"/>
                                    <ToggleSwitch Header="Memory" IsOn="{x:Bind ViewModel.ShowMemory, Mode=TwoWay}"/>
                                    <ToggleSwitch Header="GPU" IsOn="{x:Bind ViewModel.ShowGPU, Mode=TwoWay}"/>
                                    <ToggleSwitch Header="Storage" IsOn="{x:Bind ViewModel.ShowStorage, Mode=TwoWay}"/>
                                    <ToggleSwitch Header="Network" IsOn="{x:Bind ViewModel.ShowNetwork, Mode=TwoWay}"/>
                                    <ToggleSwitch Header="Controller" IsOn="{x:Bind ViewModel.ShowController, Mode=TwoWay}"/>
                                    <ToggleSwitch Header="Battery" IsOn="{x:Bind ViewModel.ShowBattery, Mode=TwoWay}"/>
                                    <ToggleSwitch Header="Power Supply" IsOn="{x:Bind ViewModel.ShowPsu, Mode=TwoWay}"/>
                                </StackPanel>
                            </Flyout>
                        </Button.Flyout>
                    </Button>

                    <Button x:Name="SettingsButton"
                            Style="{StaticResource SpeedButtonStyle}"
                            CornerRadius="8"
                            MinWidth="40"
                            Padding="8,0"
                            ToolTipService.ToolTip="Settings">
                        <FontIcon Glyph="&#xE713;" FontSize="18"/>
                        <Button.Flyout>
                            <MenuFlyout Placement="BottomEdgeAlignedRight">
                                <MenuFlyoutSubItem Text="Refresh Speed">
                                    <MenuFlyoutSubItem.Icon>
                                        <FontIcon Glyph="&#xE945;"/>
                                    </MenuFlyoutSubItem.Icon>
                                    <RadioMenuFlyoutItem Text="Ultra (250ms)"
                                                         IsChecked="{x:Bind ViewModel.IsUltraActive, Mode=OneWay}"
                                                         Command="{x:Bind ViewModel.ChangeSpeedCommand}"
                                                         CommandParameter="250"
                                                         GroupName="RefreshSpeed"/>
                                    <RadioMenuFlyoutItem Text="Fast (500ms)"
                                                         IsChecked="{x:Bind ViewModel.IsFastActive, Mode=OneWay}"
                                                         Command="{x:Bind ViewModel.ChangeSpeedCommand}"
                                                         CommandParameter="500"
                                                         GroupName="RefreshSpeed"/>
                                    <RadioMenuFlyoutItem Text="Normal (1000ms)"
                                                         IsChecked="{x:Bind ViewModel.IsNormalActive, Mode=OneWay}"
                                                         Command="{x:Bind ViewModel.ChangeSpeedCommand}"
                                                         CommandParameter="1000"
                                                         GroupName="RefreshSpeed"/>
                                </MenuFlyoutSubItem>

                                <MenuFlyoutSubItem Text="Backdrop Style">
                                    <MenuFlyoutSubItem.Icon>
                                        <FontIcon Glyph="&#xE7F4;"/>
                                    </MenuFlyoutSubItem.Icon>
                                    <RadioMenuFlyoutItem Text="Acrylic"
                                                         IsChecked="{x:Bind ViewModel.IsBackdropAcrylic, Mode=TwoWay}"
                                                         GroupName="Backdrop"/>
                                    <RadioMenuFlyoutItem Text="Mica"
                                                         IsChecked="{x:Bind ViewModel.IsBackdropMica, Mode=TwoWay}"
                                                         GroupName="Backdrop"/>
                                    <RadioMenuFlyoutItem Text="Mica Alt"
                                                         IsChecked="{x:Bind ViewModel.IsBackdropMicaAlt, Mode=TwoWay}"
                                                         GroupName="Backdrop"/>
                                </MenuFlyoutSubItem>

                                <MenuFlyoutSubItem Text="View Mode">
                                    <MenuFlyoutSubItem.Icon>
                                        <FontIcon Glyph="&#xE8FD;"/>
                                    </MenuFlyoutSubItem.Icon>
                                    <RadioMenuFlyoutItem Text="Cards"
                                                         IsChecked="{x:Bind ViewModel.IsCardsView, Mode=TwoWay}"
                                                         GroupName="ViewMode"/>
                                    <RadioMenuFlyoutItem Text="Tree"
                                                         IsChecked="{x:Bind ViewModel.IsTreeView, Mode=TwoWay}"
                                                         GroupName="ViewMode"/>
                                </MenuFlyoutSubItem>

                                <MenuFlyoutSubItem Text="Temperature Unit">
                                    <MenuFlyoutSubItem.Icon>
                                        <FontIcon Glyph="&#xE9CA;"/>
                                    </MenuFlyoutSubItem.Icon>
                                    <RadioMenuFlyoutItem Text="Celsius (°C)"
                                                         IsChecked="{x:Bind ViewModel.IsCelsiusChecked, Mode=TwoWay}"
                                                         GroupName="Temperature"/>
                                    <RadioMenuFlyoutItem Text="Fahrenheit (°F)"
                                                         IsChecked="{x:Bind ViewModel.IsFahrenheitChecked, Mode=TwoWay}"
                                                         GroupName="Temperature"/>
                                </MenuFlyoutSubItem>

                                <MenuFlyoutSeparator/>

                                <MenuFlyoutItem Text="Reset Min/Max Values"
                                                Command="{x:Bind ViewModel.ResetMinMaxCommand}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE845;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutItem Text="Run Diagnostic"
                                                Command="{x:Bind ViewModel.RunDiagnosticCommand}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE9D9;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutSeparator/>

                                <MenuFlyoutSubItem Text="Hidden Items">
                                    <MenuFlyoutSubItem.Icon>
                                        <FontIcon Glyph="&#xE711;"/>
                                    </MenuFlyoutSubItem.Icon>
                                    <MenuFlyoutItem Text="View hidden items..." Click="ShowHiddenHardware_Click">
                                        <MenuFlyoutItem.Icon>
                                            <FontIcon Glyph="&#xE890;"/>
                                        </MenuFlyoutItem.Icon>
                                    </MenuFlyoutItem>
                                    <MenuFlyoutItem Text="Restore all" Click="RestoreAllHidden_Click">
                                        <MenuFlyoutItem.Icon>
                                            <FontIcon Glyph="&#xE845;"/>
                                        </MenuFlyoutItem.Icon>
                                    </MenuFlyoutItem>
                                </MenuFlyoutSubItem>
                            </MenuFlyout>
                        </Button.Flyout>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="2">
            <ListView x:Name="HardwareList"
                      ItemsSource="{x:Bind ViewModel.HardwareNodes, Mode=OneWay}"
                      SelectionMode="None"
                      IsItemClickEnabled="False"
                      Padding="24,16,24,24"
                      Visibility="{Binding ViewModel.CurrentViewMode, ElementName=RootWindow, Converter={StaticResource ViewModeToVisibilityConverter}, ConverterParameter=Cards}">

            <ListView.Header>
                <Border Style="{StaticResource StatusCardStyle}" Margin="0,0,0,16">
                    <StackPanel Spacing="12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Spacing="4">
                                <TextBlock Text="System Status" FontSize="16" FontWeight="SemiBold"/>
                                <TextBlock Text="{x:Bind ViewModel.SystemStatusText, Mode=OneWay}"
                                          FontSize="13"
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          TextWrapping="Wrap"/>
                            </StackPanel>

                            <ProgressRing Grid.Column="1"
                                          IsActive="{x:Bind ViewModel.IsUIBusy, Mode=OneWay}"
                                          Width="24"
                                          Height="24"
                                          VerticalAlignment="Center"/>
                        </Grid>

                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    CornerRadius="6"
                                    Padding="12,8">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Refresh Rate"
                                              FontSize="10"
                                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                    <TextBlock Text="{x:Bind ViewModel.ActiveSpeedButton, Mode=OneWay}"
                                              FontSize="12"
                                              FontWeight="SemiBold"
                                              Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="1"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    CornerRadius="6"
                                    Padding="12,8">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Update Rate"
                                              FontSize="10"
                                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                    <TextBlock Text="{x:Bind ViewModel.UpsIndicator, Mode=OneWay}"
                                              FontSize="12"
                                              FontWeight="SemiBold"
                                              Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="2"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    CornerRadius="6"
                                    Padding="12,8">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Theme"
                                              FontSize="10"
                                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                    <TextBlock Text="{x:Bind ViewModel.BackdropIndicator, Mode=OneWay}"
                                              FontSize="12"
                                              FontWeight="SemiBold"
                                              Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>
            </ListView.Header>

            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem" BasedOn="{StaticResource DefaultListViewItemStyle}">
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="Margin" Value="0"/>
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:HardwareNode">
                    <Border Style="{StaticResource HardwareCardStyle}"
                            Tag="{x:Bind Name, Mode=OneWay}"
                            RightTapped="HardwareCard_RightTapped">
                        <FlyoutBase.AttachedFlyout>
                            <MenuFlyout>
                                <MenuFlyoutItem Text="Hide this item" Click="HideHardware_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE711;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                            </MenuFlyout>
                        </FlyoutBase.AttachedFlyout>
                        <StackPanel Spacing="12">
                            <Button Background="Transparent"
                                   BorderThickness="0"
                                   Padding="0"
                                   HorizontalAlignment="Stretch"
                                   HorizontalContentAlignment="Stretch"
                                   Click="ToggleExpand_Click"
                                   Tag="{Binding Mode=OneWay}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <FontIcon Grid.Column="0"
                                             Glyph="{Binding IsExpanded, Converter={StaticResource BoolToExpandIconConverter}, Mode=OneWay}"
                                             FontSize="14"
                                             Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                             Margin="0,0,8,0"
                                             VerticalAlignment="Center"/>

                                    <FontIcon Grid.Column="1"
                                              Glyph="{x:Bind CategoryIcon, Mode=OneWay}"
                                              FontSize="16"
                                              Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                              Margin="0,0,12,0"
                                              VerticalAlignment="Center"/>

                                    <TextBlock Grid.Column="2"
                                              Text="{x:Bind Name, Mode=OneWay}"
                                              FontSize="16"
                                              FontWeight="SemiBold"
                                              VerticalAlignment="Center"/>

                                    <TextBlock Grid.Column="3"
                                               Text="{x:Bind SensorCount, Mode=OneWay}"
                                               FontSize="12"
                                               FontWeight="SemiBold"
                                               Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                               VerticalAlignment="Center"
                                               Margin="8,0,0,0"/>
                                </Grid>
                            </Button>

                            <ItemsControl ItemsSource="{x:Bind SensorGroups, Mode=OneWay}"
                                         Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"
                                         ItemTemplate="{StaticResource SensorGroupTemplate}"/>

                            <ItemsControl ItemsSource="{x:Bind SubHardware, Mode=OneWay}"
                                         Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"
                                         Margin="16,8,0,0">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="models:HardwareNode">
                                        <Border Style="{StaticResource HardwareCardStyle}">
                                            <StackPanel Spacing="8">
                                                <Button Background="Transparent"
                                                        BorderThickness="0"
                                                        Padding="0"
                                                        HorizontalAlignment="Stretch"
                                                        HorizontalContentAlignment="Stretch"
                                                        Click="ToggleExpand_Click"
                                                        Tag="{Binding Mode=OneWay}">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <FontIcon Grid.Column="0"
                                                                  Glyph="{Binding IsExpanded, Converter={StaticResource BoolToExpandIconConverter}, Mode=OneWay}"
                                                                  FontSize="12"
                                                                  Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                  Margin="0,0,8,0"
                                                                  VerticalAlignment="Center"/>

                                                        <FontIcon Grid.Column="1"
                                                                  Glyph="{x:Bind CategoryIcon, Mode=OneWay}"
                                                                  FontSize="14"
                                                                  Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                                  Margin="0,0,12,0"
                                                                  VerticalAlignment="Center"/>

                                                        <TextBlock Grid.Column="2"
                                                                  Text="{x:Bind Name, Mode=OneWay}"
                                                                  FontSize="14"
                                                                  FontWeight="SemiBold"
                                                                  VerticalAlignment="Center"/>

                                                        <TextBlock Grid.Column="3"
                                                                   Text="{x:Bind SensorCount, Mode=OneWay}"
                                                                   FontSize="11"
                                                                   FontWeight="SemiBold"
                                                                   Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                                   VerticalAlignment="Center"
                                                                   Margin="8,0,0,0"/>
                                                    </Grid>
                                                </Button>

                                                <ItemsControl ItemsSource="{x:Bind SensorGroups, Mode=OneWay}"
                                                              Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"
                                                              ItemTemplate="{StaticResource SensorGroupTemplate}"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <ScrollViewer Visibility="{Binding ViewModel.CurrentViewMode, ElementName=RootWindow, Converter={StaticResource ViewModeToVisibilityConverter}, ConverterParameter=Tree}"
                      Padding="24,16,24,24">
            <ItemsControl ItemsSource="{x:Bind ViewModel.HardwareNodes, Mode=OneWay}"
                          ItemTemplate="{StaticResource TreeHardwareNodeTemplate}"/>
        </ScrollViewer>
        </Grid>
    </Grid>
</Window>
